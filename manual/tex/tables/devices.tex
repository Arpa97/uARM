\achapter{External Devices}\label{sec:man:devices}

This \acpt{} is an adapted revision of $\mu$MPS2 - Principles of Operation, Chapter 5.

\uarm{} supports five different classes of external devices: disk, tape, network card, printer and terminal. 
Furthermore, \uarm{} can support up to eight instances of each device type. 
Each single device is operated by a controller. 
Controllers exchange information with the processor via device registers; special memory locations.

A device register is a consecutive 4-word block of memory. 
By writing and reading specific fields in a given device register, the processor may both issue commands and test device status and responses.
\uarm{} implements the full-handshake interrupt-driven protocol. 
Specifically:
\begin{enumerate}
	\item Communication with device $i$ is initiated by the writing of a command code into device $i$’s device register.
	\item  Device $i$’s controller responds by both starting the indicated operation and setting a status field in $i$’s device register.
	\item When the indicated operation completes, device $i$’s controller will again set some fields in $i$’s device register; including the status field. Furthermore, device $i$’s controller will generate an interrupt exception by asserting the appropriate interrupt line. 
		The generated interrupt exception informs the processor that the requested operation has concluded and that the device requires its attention.
	\item The interrupt is acknowledged by writing the acknowledge command code in device $i$’s device register.
	\item Device $i$’s controller will de-assert the interrupt line and the protocol can restart. For performance purposes, writing a new command after the interrupt is generated will both acknowledge the interrupt and start a new operation immediately.
\end{enumerate}

The device registers are located in low-memory starting at \addr{0x0000.0040}. 
As explained in section \ref{sec:man:virtualMemory}, regardless of \register{CP15.R1}.\field{M}, all addresses between \addr{0x0000.0200} and \addr{DEVTOP} are interpreted as physical addresses. 
Furthermore, the device registers can only be accessed when the processor is executing in privileged mode.

The following table details the correspondence between device class/type and interrupt line.

\begin{center}
	\begin{tabular}{|c|c|}
		\hline
		Interrupt Line \# & Device Class\\
		\hline
		\hline
		\cellcolor{gray}0 & \cellcolor{gray}Inter-processor interrupts\\
		\hline
		\cellcolor{gray}1 & \cellcolor{gray}Processor Local Timer\\
		\hline
		2 & Bus (Interval Timer)\\
		\hline
		3 & Disk Devices\\
		\hline
		4 & Tape Devices\\
		\hline
		5 & Network (Ethernet) Devices\\
		\hline
		6 & Printer Devices\\
		\hline
		7 & Terminal Devices\\
		\hline
	\end{tabular}
\end{center}

Some important issues relating to device management:
\begin{itemize}
	\item Since there are multiple interrupt lines, and multiple devices attached to the same interrupt line, at any point in time there may be multiple interrupts pending simultaneously; both across interrupt lines and on the same interrupt line.
	\item The lower the interrupt line number, the higher the priority of the interrupt.
		Note how fast/critical devices (e.g. disk devices) are attached to a high priority interrupt line while slow devices are attached to the low priority interrupt lines.
	\item Interrupt lines 3-7 are used for external devices. Interrupt lines 0-2 are for internally generated interrupts.
		Lines 0-1 are present for future multiprocessor support, but currently unused.
	\item Disk and tape devices support Direct Memory Access (DMA); that is through cooperation with the bus, these devices are able to transfer whole blocks of data to/from memory from/to the device. 
		Data blocks must be both wordaligned and of multiple-word in size. 
		\uarm{} supports any number of concurrent DMA operations; each on a different device. 
		Care must be taken to prevent simultaneous DMA operations on the same chunk of memory.
	\item After an operation has begun on a device, its device register “freezes” - becomes read-only - and will not accept any other commands until the operation completes.
	\item Any device register for an uninstalled device is “frozen” - set to zero - and subsequent writes to the device register have no effect.
	\item Device registers use only physical addresses; this includes addresses used in DMA operations.
	\item Each external device in \uarm{} is identified by the interrupt line it is attached to and its device number; an integer in [0..7]. 
		\uarm{} limits the number of devices per interrupt line to eight.
	\item For performance reasons, devices in the same class are, by default, attached to the same interrupt line.
\end{itemize}


\asection{Device Registers}

All external devices share the same device register structure.

While each device class has a specific use and format for these fields, all device classes, except terminal devices, use:

\begin{itemize}
	\item \register{COMMAND} to allow commands to be issued to the device controller.
	\item \register{STATUS} for the device controller to communicate the device status to the processor.
	\item \register{DATA0} \& \register{DATA1} to pass additional parameters to the device controller or the passing of data from the device controller.
\end{itemize}

\begin{center}
	\begin{tabular}{|c|c|c|}
		\hline
		Field \# & Address & Field Name\\
		\hline
		\hline
		0 & (base) + \addr{0x0} & \register{STATUS}\\
		\hline
		1 & (base) + \addr{0x4} & \register{COMMAND}\\
		\hline
		2 & (base) + \addr{0x8} & \register{DATA0}\\
		\hline
		3 & (base) + \addr{0xC} & \register{DATA1}\\
		\hline
	\end{tabular}
\end{center}

All 40 device registers in \uarm{} are located in low memory starting at \addr{0x0000.0040}.

\spinput{dev_regs.tex}

Given an interrupt line (IntLineNo) and a device number (DevNo) one can compute the starting address of the device’s device register:

\begin{center}
	devAddrBase = \addr{0x0000.0040} + ((IntlineNo - 3) * \addr{0x80}) + (DevNo * \addr{0x10})
\end{center}

\asection{The Bus Device and Interval Timer}

The bus acts as the interface between the processor and the RAM, ROM, and all the external devices. 
In particular the bus performs the following tasks:

\begin{enumerate}
	\item Management of the time of Day (TOD) clock and Interval Timer.
	\item Arbitration among the interrupt lines, the devices attached to each interrupt line and the device registers.
	\item Repository of basic system information.
\end{enumerate}

\asubsection{Interval Timer}\label{sec:man:intervalTimer}

A read/writable unsigned word that is decremented by one every processor cycle and is set by \uarm{} circuitry to \addr{0xFFFF.FFFF} at system boot/reset time. 
The Interval Timer will generate an interrupt on interrupt line 2 whenever it makes the \addr{0x0000.0000} $\rightarrow$ \addr{0xFFFF.FFFF} transition.
This is the only device attached to interrupt line 2, hence any interrupt on this line may be assumed to be associated with the Interval Timer. 
Interval Timer interrupts are acknowledged by writing a new value into the Interval Timer register.

The Interval Timer device register is located at \addr{0x0000.02E4} (see sec. \ref{sec:man:systemInformationRegisters}).


\asection{Disk Devices}

\uarm{} supports up to eight DMA supporting read/writable hard disk drive devices. 
All \uarm{} disk drives have a blocksize equal to the \uarm{} framesize of 4KB. 
Each installed disk drive’s device register \register{DATA1} field is read-only and describes the physical characteristics of the device’s geometry.

\spinput{disk_data.tex}

\uarm{} disk drives can have up to 65536 cylinders/track, addressed [0..(\field{MAXCYL}-1)]; 256 heads (or track surfaces), addressed [0..(\field{MAXHEAD}-1)]; and 256 sectors/track, addressed [0..(\field{MAXSECT}-1)]. Each 4KB physical disk block (or sector) can be addressed by specifying its coordinates: (cyl, head, sect).

A disk drive’s device register \register{STATUS} field is read-only and will contain one of the following status codes:

\begin{center}
	\begin{tabular}{|c|c|c|}
		\hline
		Code & Status & Possible Reason for Code \\
		\hline
		\hline
		0 & Device Not Installed & Device not installed\\
		\hline
		1 & Device Ready & Device waiting for a command\\
		\hline
		2 & Illegal Operation Code Error & Device presented unknown command\\
		\hline
		3 & Device Busy & Device executing a command\\
		\hline
		4 & Seek Error & Illegal parameter/hardware failure\\
		\hline
		5 & Read Error & Illegal parameter/hardware failure\\
		\hline
		6 & Write Error & Illegal parameter/hardware failure\\
		\hline
		7 & DMA Transfer Error & Illegal physical address/hardware failure\\
		\hline
	\end{tabular}
\end{center}

Status codes 1, 2, and 4-7 are completion codes. 
An illegal parameter may be an out of bounds value (e.g. a cylinder number outside of [0..(\field{MAXCYL}-1)]), or a non-existent physical address for DMA transfers.

A disk drive’s device register \register{DATA0} field is read/writable and is used to specify the starting physical address for a read or write DMA operation. 
Since memory is addressed from low addresses to high, this address is the lowest word-aligned physical address of the 4KB block about to be transferred.

A disk drive’s device register \register{COMMAND} field is read/writable and is used to issue commands to the disk drive.

\begin{center}
	\begin{tabular}{|c|c|>{\centering\arraybackslash}p{11cm}|}
		\hline
		Code & Command & Operation\\
		\hline
		\hline
		0 & RESET & Reset the device and move the boom to cylinder 0\\
		\hline
		1 & ACK & Acknowledge a pending interrupt\\
		\hline
		2 & SEEKCYL & Seek to the specified \field{CYLNUM}\\
		\hline
		3 & READBLK & Read the block located at (\field{HEADNUM}, \field{SECTNUM}) in the current cylinder and copy it into RAM starting at the address in \register{DATA0}\\
		\hline
		4 & WRITEBLK & Copy the 4KB of RAM starting at the address in \register{DATA0} into the block located at (\field{HEADNUM}, \field{SECTNUM}) in the current cylinder\\
		\hline
	\end{tabular}
\end{center}

The format of the \register{COMMAND} field, as illustrated in Figure 5.4, differs depending on which command is to be issued:

\spinput{disk_cmd.tex}

A disk operation is started by loading the appropriate value into the \register{COMMAND} field. 
For the duration of the operation the device’s status is “Device Busy.” 
Upon completion of the operation an interrupt is raised and an appropriate status code is set; “Device Ready” for successful completion or one of the error codes. 
The interrupt is then acknowledged by issuing an ACK or RESET command.

Disk device performance, because both read and write operations are DMA-based, strongly depends on the system clock speed. 
While read/write throughput may reach MB’s/sec in magnitude, the disk hardware operations remain in the millisecond range.


\asection{Tape Devices}

\uarm{} supports up to eight tape-removable, DMA supporting, read-only tape devices.
All \uarm{} tape devices support a blocksize of 4KB. 
Each installed tape device’s register \register{DATA1} field is read-only and describes the current marker under the tape head when the device is idle.

\begin{center}
	\begin{tabular}{|c|c|c|}
		\hline
		Code & Marker & Meaning\\
		\hline
		\hline
		0 & \uline{EOT} & End of Tape\\
		\hline
		1 & \uline{EOF} & End of File\\
		\hline
		2 & \uline{EOB} & End of Block\\
		\hline
		3 & \uline{TS} & Tape Start\\
		\hline
	\end{tabular}
\end{center}

A tape starts with a \uline{TS} marker and ends with an \uline{EOT} marker. 
It may be viewed as a collection of blocks, delimited by \uline{EOB} markers, which are divided into files, delimited by \uline{EOF} markers. 
An \uline{EOF} marker acts as the \uline{EOB} marker for the last block of the file and the \uline{EOT} marker act as the \uline{EOF} (and therefore also an \uline{EOB}) marker for the last file on the tape.

When there is no tape cartridge loaded into the tape device, the \register{DATA1} field will contain the \uline{EOT} marker, and the \register{STATUS} field will contain the Device Ready code. 
Since there is no tape cartridge present, the \register{COMMAND} field, though, will not accept any commands. 
Only when a tape is loaded does the device “wake up” and begin accepting commands. 
When a tape cartridge is loaded, the tape device rewinds the cartridge back to the \uline{TS} marker.

A tape drive’s device register \register{STATUS} field is read-only and will contain one of the following status codes:


\begin{center}
	\begin{tabular}{|c|c|c|}
		\hline
		Code & Status & Possible Reason for Code\\
		\hline
		\hline
		0 & Device Not Installed & Device not installed\\
		\hline
		1 & Device Ready & Device waiting for a command\\
		\hline
		2 & Illegal Operation Code Error & Device presented unknown command\\
		\hline
		3 & Device Busy & Device executing a command\\
		\hline
		4 & Skip Error & Illegal command/hardware failure\\
		\hline
		5 & Read Error & Illegal command/hardware failure\\
		\hline
		6 & Back 1 Block Error & Illegal command/hardware failure\\
		\hline
		7 & DMA Transfer Error & Illegal physical address/hardware failure\\
		\hline
	\end{tabular}
\end{center}

Status codes 1, 2, and 4-7 are completion codes. 
An illegal parameter may be an attempt to read beyond the \uline{EOT} marker or a non-existent physical address for DMA transfers.

A tape drive’s device register \register{DATA0} field is read/writable and is used to specify the starting physical address for a DMA read operation. 
Since memory is addressed from low addresses to high, this address is the lowest word-aligned physical address of the 4 KB block about to be transferred.

A tape drive’s device register \register{COMMAND} field is read/writable and is used to issue commands to the tape drive.

\begin{center}
	\begin{tabular}{|c|c|>{\centering\arraybackslash}p{11cm}|}
		\hline
		Code & Command & Operation\\
		\hline
		\hline
		0 & RESET & Reset the device and rewind the tape to \uline{TS} marker\\
		\hline
		1 & ACK & Acknowledge a pending interrupt\\
		\hline
		2 & SKIPBLK & Forward the tape up to the next \uline{EOB}/\uline{EOT}\\
		\hline
		3 & READBLK & Read the current block up to the next \uline{EOB}/\uline{EOT} marker and copy it into RAM starting at the address in \register{DATA0}\\
		\hline
		4 & BACKBLK & Rewind the tape to the previous \uline{EOB}/\uline{EOT} marker\\
		\hline
	\end{tabular}
\end{center}

A tape operation is started by loading the appropriate value into the \register{COMMAND} field. 
For the duration of the operation the device’s status is “Device Busy.” 
Upon completion of the operation an interrupt is raised and an appropriate status code is set; “Device Ready” for successful completion or one of the error codes. 
The interrupt is then acknowledged by issuing an ACK or RESET command.

Tape device performance, because read operations are DMA-based, strongly depends on the system clock speed. Tape read throughput can range from 2 MB/sec when the processor clock is set at 1 MHz, to over 4 MB/sec when the processor clock is bumped up to 99 MHz.


\asection{Network (Ethernet) Adapters}

\uarm{} supports up to eight DMA supporting network (i.e. Ethernet) adapters. 
Though these devices are DMA-based, they are not block devices. 
Network adapters operate at the byte level and transfer into/out of memory only the amount of data called for. 
Since packets on a network typically follow standard MTU sizes, this data should never exceed (by much) 1500 bytes.

Network adapters share some characteristics with terminal devices; they are simultaneously both an input device and an output device. 
As an output device, network adapters behave like other peripherals: a write command is issued and when the write (i.e. transmit) is completed, an interrupt is generated.

For packet receipt, there are two modes of operation:

\begin{itemize}
	\item Interrupt Enabled: Whenever a packet arrives, an interrupt is generated - this interrupt is not the result of an earlier command. 
		After ACK’ing this interrupt one issues a READNET command to read the packet. 
		When the read is completed, another interrupt is generated, which itself must also be ACK’ed. 
		In Interrupt Enabled mode, each incoming packet, when successfully read, is a two-interrupt sequence.
	\item Interrupt Disabled: When packets arrive, no interrupt is generated. 
		The network adapter must be polled to determine if a packet is available. 
		The READNET command is non-blocking, and returns 0 if there is no packet to be read. 
		The READNET command will still generate an interrupt, which must be ACK’ed, upon its conclusion.
\end{itemize}

A network adapter’s device register \register{STATUS} field is read-only and will contain one of the following status codes:

\begin{center}
	\begin{tabular}{|c|c|c|}
		\hline
		Code & Status & Possible Reason for Code\\
		\hline
		\hline
		0 & Device Not Installed & Device not installed\\
		\hline
		1 & Device Readya & Device waiting for a command\\
		\hline
		2 & Illegal Operation Code Error & Device presented unknown command\\
		\hline
		3 & Device Busy & Device executing a command\\
		\hline
		5 & Read Error & Error reading packet from device\\
		\hline
		6 & Write Error & Error attempt to send packet\\
		\hline
		7 & DMA Transfer Error & Illegal physical address/hardware failure\\
		\hline
		128 & Read Pending & Interrupts Enabled and packet present\\
		\hline
	\end{tabular}
\end{center}

Status codes 1, 2, and 5-7 are completion codes. 
An illegal address may be an out of bounds value or a non-existent physical address for DMA transfers.

Status code 128 is not a distinct status code, it is used in a logical OR fashion with the other status codes. 
Hence there are actually thirteen status values: 0, (1 \& 129), (2 \& 130),. . . , (7 \& 135). 
For example, a status code value of 130 indicates that both an illegal operation was requested AND there is a packet pending for reading. 
The Read Pending status codes are only used when the network adapter is operating Interrupt Enable mode.

\begin{center}
	\begin{tabular}{|c|c|>{\centering\arraybackslash}p{11cm}|}
		\hline
		Code & Command & Operation\\
		\hline
		\hline
		0 & RESET & Reset the device and reset all configuration data to defaults\\
		\hline
		1 & ACK & Acknowledge a pending interrupt\\
		\hline
		2 & READCONF & Read configuration data into DATA0 \& DATA1\\
		\hline
		3 & READNET & Read the next packet from the adapter and copy it into RAM starting at the address in DATA0\\
		\hline
		4 & WRITENET & Send a packet of data starting at the RAM address in DATA0, whose length is in DATA1\\
		\hline
		5 & CONFIG & Update adapter configuration data from values in DATA0 \& DATA1\\
		\hline
	\end{tabular}
\end{center}

\spinput{net_data0.tex}

\spinput{net_data1.tex}


The \register{DATA0} fields, during configuration operations (READCONF \& CONFIG), are defined as follows:
\begin{itemize}
	\item \field{ND} (NAMED, bit 8): When \register{DATA0}.\field{ND}=1, the network adapter will automatically fill all outgoing packets’ source MAC address field with the network adapter’s MAC address.
	\item \field{IE} (Interrupt Enable, bit 9): If \register{DATA0}.\field{IE}=1, whenever a packet is pending on the device (i.e. waiting to be read), it will immediately generate an interrupt. 
		After ACK’ing this interrupt, one issues a READNET command to facilitate the reading of the packet. 
		The READNET command must then also be ACK’ed.
	\item \field{PQ} (PROMISQ, bit 10): If \register{DATA0}.\field{PQ}=1 the network adapter will capture and save all packets its receives. 
		When \register{DATA0}.\field{PQ}=0, the device will ignore/drop any packets not intended for its MAC address. 
		Broadcast packets will still be received even when \register{DATA0}.\field{PQ}=0.
	\item \field{SM} (SetMAC, bit 15): When \register{DATA0}.\field{SM}=1 and a CONFIG command is issued, the MAC address of the adapter is updated to the values in \register{DATA0} \& \register{DATA1}. When \register{DATA0}.\field{SM}=0 and a CONFIG command is issued, the adapter’s MAC address remains unchanged.
\end{itemize}

As described above, the \register{DATA0} \& \register{DATA1} fields are overloaded; either containing device status values or DMA addresses and lengths. 
One uses the CONFIG to set network adapter configuration values. 
Similarly, after a READNET or WRITENET operation, one can use a READCONF operation to reset the \register{DATA0} \& \register{DATA1} registers to reflect the current adapter configuration values.


\asection{Printer Devices}

\uarm{} supports up to eight parallel printer interfaces, each one with a single 8-bit character transmission capability.

The \register{DATA0} field for printer devices is read/writable and is used to set the character to be transmitted to the printer. 
The character is placed in the low-order byte of the \register{DATA0} field. 
The \register{DATA1} field, for printer devices is not used.

\spinput{print_data.tex}

A printer’s device register \register{STATUS} field is read-only and will contain one of the following status codes:

\begin{center}
	\begin{tabular}{|c|c|c|}
		\hline
		Code & Status & Possible Reason for Code\\
		\hline
		\hline
		0 & Device Not Installed & Device not installed\\
		\hline
		1 & Device Ready & Device waiting for a command\\
		\hline
		2 & Illegal Operation Code Error & Device presented unknown command\\
		\hline
		3 & Device Busy & Device executing a command\\
		\hline
		4 & Print Error & Error during character transmission\\
		\hline
	\end{tabular}
\end{center}

Status codes 1, 2, and 4 are completion codes.

A printer’s device register \register{COMMAND} field is read/writable and is used to issue commands to the printer interface.

\begin{center}
	\begin{tabular}{|c|c|c|}
		\hline
		Code & Command & Operation\\
		\hline
		\hline
		0 & RESET & Reset the device interface\\
		\hline
		1 & ACK & Acknowledge a pending interrupt\\
		\hline
		2 & PRINTCHR & Transmit the character in DATA0 over the line\\
		\hline
	\end{tabular}
\end{center}

A printer operation is started by loading the appropriate value into the \register{COMMAND} field. 
For the duration of the operation the device’s status is “Device Busy.” 
Upon completion of the operation an interrupt is raised and an appropriate status code is set; “Device Ready” for successful completion or one of the error codes. 
The interrupt is then acknowledged by issuing an ACK or RESET command.

The printer interface’s maximum throughput is 125 KB/sec.


\asection{Terminal Devices}

\uarm{} supports up to eight serial terminal device interfaces, each one with a single 8-bit character transmission and receipt capability.

Each terminal interface contains two sub-devices; a transmitter and a receiver. 
These two sub-devices operate independently and concurrently. 
To support the two-subdevices a terminal interface’s device register is redefined as follows:

\begin{center}
	\begin{tabular}{|c|c|c|}
		\hline
		Field \# & Address & Field Name\\
		\hline
		\hline
		0 & (base) + 0x0 & RECV STATUS\\
		\hline
		1 & (base) + 0x4 & RECV COMMAND\\
		\hline
		2 & (base) + 0x8 & TRANSM STATUS\\
		\hline
		3 & (base) + 0xc & TRANSM COMMAND\\
		\hline
	\end{tabular}
\end{center}

The \register{TRANSM\_STATUS} and \register{RECV\_STATUS} fields (device register fields 0 \& 2) are read-only and have the following format.

\spinput{term_status.tex}

The \field{Status} byte has the following meaning:

\begin{center}
	\begin{tabular}{|c|c|c|}
		\hline
		Code & RECV STATUS & TRANSM STATUS\\
		\hline
		\hline
		0 & Device Not Installed & Device not installed\\
		\hline
		1 & Device Ready & Device Ready\\
		\hline
		2 & Illegal Operation Code Error & Illegal Operation Code Error\\
		\hline
		3 & Device Busy & Device Busy\\
		\hline
		4 & Receive Error & Transmission Error\\
		\hline
		5 & Character Received & Character Transmitted\\
		\hline
	\end{tabular}
\end{center}

The meaning of status codes 0-4 are the same as with other device types.
Furthermore:
\begin{itemize}
	\item The Character Received code (5) is set when a character is correctly received from the terminal and is placed in \register{RECV\_STATUS}.\field{RECV’D-CHAR}.
	\item The Character Transmitted code (5) is set when a character is correctlytransmitted to the terminal and is placed in \register{TRANSM\_STATUS}.\field{TRANS’D-CHAR}.
	\item The Device Ready code (1) is set as a response to an ACK or RESET command.
\end{itemize}

A terminal’s \register{TRANSM\_COMMAND} and \register{RECV\_COMMAND} fields are read/ writable and are used to issue commands to the terminal’s interface.

\begin{center}
	\begin{tabular}{|c|c|c|>{\centering\arraybackslash}p{6cm}|}
		\hline
		& TRANSM & RECV & \\
		Code & COMMAND & COMMAND & Operation \\
		\hline
		\hline
		0 & RESET & RESET & Reset the transmitter or receiver interface\\
		\hline
		1 & ACK & ACK & Ack a pending interrupt\\
		\hline
		2 & TRANSMITCHAR & RECEIVECHAR & Transmit or Receive the character over the line\\
		\hline
	\end{tabular}
\end{center}

The \register{TRANSM\_COMMAND} and \register{RECV\_COMMAND} fields have the following format:

\spinput{term_cmd.tex}

\register{RECV\_COMMAND}.\field{RECV-CMD} is simply the command.\\
The \register{TRANSM\_COMMAND} field has two parts; the command itself \linebreak(\register{TRANSM\_COMMAND}.\field{TRANSM-CMD}) and the character to be transmitted \linebreak(\register{TRANSM\_COMMAND}.\field{TRANSM-CHAR}).

A character is received, and placed in \register{RECV\_STATUS}.\field{RECV’D-CHAR} only after a RECEIVECHAR command has been issued to the receiver.


The operation of a terminal device is more complicated than other devices because it is two sub-devices sharing the same device register interface. 
When a terminal device generates an interrupt, the (operating system’s) terminal device interrupt handler, after determining which terminal generated the interrupt, must furthermore determine if the interrupt is for receiving a character, for transmitting a character, or both; i.e. two interrupts pending simultaneously.

If there are two interrupts pending simultaneously, both must be acknowledged in order to have the appropriate interrupt pending bit in the Interrupt Line 7 Interrupting Devices Bit Map turned off.

To make it possible to determine which sub-device has a pending interrupt there are two sub-device “ready” conditions; Device Ready and Character Received/Transmitted. 
While other device types can use a Device Ready code to signal a successful completion, this is insufficient for terminal devices. 
For terminal devices it is necessary to distinguish between a state of successful completion though the interrupt is not yet acknowledged, Character Received/Transmitted, and a command whose completion has been acknowledged, Device Ready.

A terminal operation is started by loading the appropriate value(s) into the \linebreak \register{TRANSM\_COMMAND} or \register{RECV\_COMMAND} field. 
For the duration of the operation the sub-device’s status is “Device Busy.” 
Upon completion of the operation an interrupt is raised and an appropriate status code is set in \register{TRANSM\_STATUS} or \register{RECV\_STATUS} respectively; “Character Transmitted/Received” for successful completion or one of the error codes. 
The interrupt is acknowledged by issuing an ACK or RESET command to which the sub-device responds by setting the Device Ready code in the respective status field.

The terminal interface’s maximum throughput is 12.5 KB/sec for both character transmission and receipt.


