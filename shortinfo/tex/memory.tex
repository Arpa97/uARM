\chapter{Memory Interface}
Memory system is controlled by Program Status Register (CPSR) and System Coprocessor's registers 1 and 2 (CP15.R1 \& CPSR.R2). It supports two operating modes:

\begin{itemize}
\item physical addressing mode, 
\item virtual addressing mode.
\end{itemize}

In addition to address translation modes, the portion of accessible memory is dictated by processor operating mode:

\begin{itemize}
\item User mode $\rightarrow$ User Space
\item Privileged mode $\rightarrow$ All Memory
\end{itemize}

In each addressing mode theese portions have a specific definition.

As described in System Bus chapter, sddresses below \texttt{0x00008000} are reserved for hardware/protected functions and belong to the \emph{reserved address space}.

\section{Physical addressing mode}
The machine starts execution in this mode, each address is used directly without conversions.

All the available memory is directly accessible in Privileged mode and any address over 0x00008000 is directly accessible in User mode.

\section{Virtual addressing mode}
By setting M flag in System Coprocessor's register 1 (CP15.R1.M, that is least significative bit), you enable memory address translation.

When the MMU is enabled the user process ASID is stored in the EntryHy field of CP15's 64bit register R2 along whith the Virtual Page Frame number. The EntryLow filed contains the Physical Page Frame address and is kept up to date after each modification of CP15.R2.EntryHy value.

The CP15 register 2 is organized as a Segment Table Entry:
\\

\input{tex/tables/CP15.R2.tex}

The Low half of each entry contains 4 flags used for memory protection:
\begin{itemize}
\item \textbf{N}on Chachable bit: not used by uARM implementation.
\item \textbf{D}irty bit: if the bit is clear, any write access to the physical frame locations will rise a TLB-Modification excepion.
\item \textbf{V}alid bit: if bit is set the Page Table Entry is considered valid, otherwise a TLB-Invalid exception is raised.
\item \textbf{G}lobal bit: if the bit is set, the Page Table Entry will match the corresponding VPN regardless of the ASID.
\end{itemize}
